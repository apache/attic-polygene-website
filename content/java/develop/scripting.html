<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Scripting</title><link rel="stylesheet" type="text/css" href="css/style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="" /><link rel="up" href="libraries.html" title="Libraries" /><link rel="prev" href="libraries.html" title="Libraries" /><link rel="next" href="library-alarm.html" title="Alarms" />


<!-- favicon -->

<link rel="shortcut icon" href="http://polygene.apache.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://polygene.apache.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/polygene.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>

<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Apache Polygene WebSite Progressive Enhancement -->

<link href="css/progressive-enhancement.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.scrollTo-1.4.2.js"></script>
<script type="text/javascript" src="js/progressive-enhancement.js"></script>

<!-- Analytics -->
 <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-62007352-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
 </script>

  </head><body><div xmlns="" xmlns:exsl="http://exslt.org/common" class="logo"><a href="index.html"><img src="images/logo-standard.png" /></a></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="top-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl><dt><span class="section"><a href="index.html#home">Polygene™</a></span></dt><dt><span class="section"><a href="intro.html">Introduction</a></span></dt><dt><span class="section"><a href="tutorials.html">Tutorials</a></span></dt><dt><span class="section"><a href="javadocs.html">Javadoc</a></span></dt><dt><span class="section"><a href="samples.html">Samples</a></span></dt><dt><span class="section"><a href="core.html">Core</a></span></dt><dt><span class="section"><span xmlns="" href="libraries.html">Libraries</span></span></dt><dt><span class="section"><a href="extensions.html">Extensions</a></span></dt><dt><span class="section"><a href="tools.html">Tools</a></span></dt><dt><span class="section"><a href="glossary.html">Glossary </a></span></dt></dl></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="sub-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl><dt><span class="section"><a href="libraries.html#_overview_5">Overview</a></span></dt><dt><span class="section"><span xmlns="" href="scripting.html">Scripting</span></span></dt><dt><span class="section"><a href="library-alarm.html">Alarms</a></span></dt><dt><span class="section"><a href="library-circuitbreaker.html">Circuit Breaker</a></span></dt><dt><span class="section"><a href="library-constraints.html">Constraints</a></span></dt><dt><span class="section"><a href="library-fileconfig.html">FileConfig</a></span></dt><dt><span class="section"><a href="library-http.html">HTTP</a></span></dt><dt><span class="section"><a href="library-invocation-cache.html">Invocation Cache</a></span></dt><dt><span class="section"><a href="library-jmx.html">JMX</a></span></dt><dt><span class="section"><a href="library-locking.html">Locking</a></span></dt><dt><span class="section"><a href="library-logging.html">Logging</a></span></dt><dt><span class="section"><a href="library-osgi.html">OSGi</a></span></dt><dt><span class="section"><a href="library-rdf.html">RDF</a></span></dt><dt><span class="section"><a href="library-rest-client.html">ReST Client</a></span></dt><dt><span class="section"><a href="library-rest-client-primer.html">ReST - HATEOAS Primer</a></span></dt><dt><span class="section"><a href="library-rest-common.html">ReST Common</a></span></dt><dt><span class="section"><a href="library-rest-server.html">ReST Server</a></span></dt><dt><span class="section"><a href="library-restlet.html">Restlet Support</a></span></dt><dt><span class="section"><a href="library-servlet.html">Servlet</a></span></dt><dt><span class="section"><a href="library-shiro.html">Shiro Security</a></span></dt><dt><span class="section"><a href="library-shiro-web.html">Shiro Web Security</a></span></dt><dt><span class="section"><a href="library-spring.html">Spring Integration</a></span></dt><dt><span class="section"><a href="library-sql.html">SQL</a></span></dt><dt><span class="section"><a href="library-uid.html">UID</a></span></dt><dt><span class="section"><a href="library-uowfile.html">UoWFile</a></span></dt></dl></div></div><div class="section" title="Scripting"><div class="titlepage"><div><div><h3 class="title"><a id="scripting"></a>Scripting</h3></div></div></div><p class="remark"><em><span class="comment"></span></em></p><p class="devstatus-code-stable">code</p><p class="devstatus-docs-good">docs</p><p class="devstatus-tests-good">tests</p><p>The Scripting Library allows Mixin methods to be implemented in any JSR-223 scripting language, loaded dynamically on
first use and allowing reloading of the script in runtime.</p><div class="table"><a id="idm229754936752"></a><p class="title"><strong>Table 19. Artifact</strong></p><div class="table-contents"><table summary="Artifact" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top">Group ID</th><th align="left" valign="top">Artifact ID</th><th align="left" valign="top">Version</th></tr></thead><tbody><tr><td align="left" valign="top"><p>org.apache.polygene.libraries</p></td><td align="left" valign="top"><p>org.apache.polygene.library.scripting</p></td><td align="left" valign="top"><p>3.1.0-SNAPSHOT</p></td></tr></tbody></table></div></div><br class="table-break" /><p>The Scripting Library is a Generic mixin class that implements
Composite interfaces by delegating to script functions using Java Scripting API. All Java Scripting API (JSR-223)
implementations that support</p><pre class="programlisting brush: java">    ((javax.script.Invocable) scriptEngine).invokeFunction( functionName, arguments );</pre><p>should be supported. On Java.Net there is a <a class="ulink" href="https://java.net/projects/scripting/sources/svn/show/trunk/engines" target="_top">list of Java Scripting API languages</a>.</p><p>It is important to understand that the ScriptEngines must be present on the classpath, or they will not be available,
with the exception of JavaScript which uses the built-in Nashorn engine.</p><p>We welcome additional information and samples of languages that has been tried and tested.</p><div class="table"><a id="idm229754921232"></a><p class="title"><strong>Table 20. Language Support</strong></p><div class="table-contents"><table summary="Language Support" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /><col class="col_5" /></colgroup><thead><tr><th align="left" valign="top">Language </th><th align="left" valign="top"> Supported </th><th align="left" valign="top"> Tested </th><th align="left" valign="top"> License </th><th align="left" valign="top"> Implementation</th></tr></thead><tbody><tr><td align="left" valign="top"><p>JavaScript</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>?</p></td><td align="left" valign="top"><p>Nashorn, built-in Java 8 and later</p></td></tr><tr><td align="left" valign="top"><p>Groovy</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>Apache</p></td><td align="left" valign="top"><p>Apache Groovy</p></td></tr><tr><td align="left" valign="top"><p>Ruby</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>No</p></td><td align="left" valign="top"><p>(EPL|GPL|LGPL) + Ruby</p></td><td align="left" valign="top"><p>JRuby</p></td></tr><tr><td align="left" valign="top"><p>Python</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>No</p></td><td align="left" valign="top"><p><a class="ulink" href="https://opensource.org/licenses/Python-2.0" target="_top">Python</a></p></td><td align="left" valign="top"><p>Jython, must use jython-standalone</p></td></tr><tr><td align="left" valign="top"><p>Kotlin</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>No</p></td><td align="left" valign="top"><p>Apache</p></td><td align="left" valign="top"><p>Jetbrains</p></td></tr><tr><td align="left" valign="top"><p>Lua</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>No</p></td><td align="left" valign="top"><p>MIT</p></td><td align="left" valign="top"><p>luaj.org,</p></td></tr><tr><td align="left" valign="top"><p>Clojure</p></td><td align="left" valign="top"><p>Yes</p></td><td align="left" valign="top"><p>No</p></td><td align="left" valign="top"><p>CPL</p></td><td align="left" valign="top"><p><a class="ulink" href="https://github.com/pmf/clojure-jsr223" target="_top">https://github.com/pmf/clojure-jsr223</a></p></td></tr></tbody></table></div></div><br class="table-break" /><p>The following languages may or may not be supported, and was found at <a class="ulink" href="https://java.net/projects/scripting/sources/svn/show/trunk/engines" target="_top">Java.Net Scripting project</a></p><div class="table"><a id="idm229754872336"></a><p class="title"><strong>Table 21. Potential Languages</strong></p><div class="table-contents"><table summary="Potential Languages" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top"> Language </th><th align="left" valign="top"> Location </th><th align="left" valign="top"> License</th></tr></thead><tbody><tr><td align="left" valign="top"><p>beanshell</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>ejs</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>freemarker</p></td><td align="left" valign="top"><p><a class="ulink" href="https://freemarker.apache.org" target="_top">https://freemarker.apache.org</a></p></td><td align="left" valign="top"><p>Apache</p></td></tr><tr><td align="left" valign="top"><p>jacl</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>jaskell</p></td><td align="left" valign="top"><p><a class="ulink" href="https://github.com/MarchLiu/jaskell" target="_top">https://github.com/MarchLiu/jaskell</a></p></td><td align="left" valign="top"><p>MIT</p></td></tr><tr><td align="left" valign="top"><p>jawk</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>jelly</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p>Apache</p></td></tr><tr><td align="left" valign="top"><p>jep</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>jexl</p></td><td align="left" valign="top"><p><a class="ulink" href="https://commons.apache.org/jexl/" target="_top">https://commons.apache.org/jexl/</a></p></td><td align="left" valign="top"><p>Apache</p></td></tr><tr><td align="left" valign="top"><p>jst</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>judo</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>juel</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>ognl</p></td><td align="left" valign="top"><p><a class="ulink" href="https://commons.apache.org/ognl/" target="_top">https://commons.apache.org/ognl/</a></p></td><td align="left" valign="top"><p>Apache</p></td></tr><tr><td align="left" valign="top"><p>pnuts</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p>scheme</p></td><td align="left" valign="top"><p><a class="ulink" href="http://sisc-scheme.org/" target="_top">http://sisc-scheme.org/</a></p></td><td align="left" valign="top"><p>(MPLv1.1</p></td></tr><tr><td align="left" valign="top"><p>GPLv2)</p></td><td align="left" valign="top"><p>velocity</p></td><td align="left" valign="top"><p><a class="ulink" href="https://velocity.apache.org" target="_top">https://velocity.apache.org</a></p></td></tr><tr><td align="left" valign="top"><p>Apache</p></td><td align="left" valign="top"><p>xpath</p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p>xslt</p></td><td align="left" valign="top"><p></p></td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idm229754806480"></a><p class="title"><strong>Table 22. Not Compatible Languages</strong></p><div class="table-contents"><table summary="Not Compatible Languages" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top"> Language </th><th align="left" valign="top"> Comment</th></tr></thead><tbody><tr><td align="left" valign="top"><p>Java</p></td><td align="left" valign="top"><p>Implementation exists at <a class="ulink" href="https://github.com/nickman/javax-scripting/" target="_top">https://github.com/nickman/javax-scripting/</a> which is forked from <a class="ulink" href="https://java.net/projects/scripting" target="_top">https://java.net/projects/scripting</a>. It doesn’t support Invocable, and additional work on ScriptMixin is required to support this. Alternatively, fork the ScriptEngine implementation and support Invocable in it.</p></td></tr></tbody></table></div></div><br class="table-break" /><div class="section" title="Javascript"><div class="titlepage"><div><div><h4 class="title"><a id="javascript"></a>Javascript</h4></div></div></div><p>In Javascript, we map directly to JS functions with the same name.</p><p>For the following Polygene composite type,</p><pre class="programlisting brush: java">package org.apache.polygene.library.scripting;
  [...snip...]


@Mixins(ScriptMixin.class)
public interface HelloSpeaker
{
    String sayHello();
}
</pre><p>we need a implementation in a resource file (visible on classpath) named <code class="literal">org/apache/polygene/library/scripting/HelloSpeaker.js</code>
that looks like this;</p><pre class="programlisting brush: javascript">function sayHello() {
    return "Hello, JavaScript";
}
</pre></div><div class="section" title="Groovy"><div class="titlepage"><div><div><h4 class="title"><a id="groovy"></a>Groovy</h4></div></div></div><p>The Groovy Scripting Library is a Generic mixin that implements interfaces by delegating to Groovy code from classpath resources.</p><p>But before looking at how to use the Scripting library we’ll see that <span class="strong"><strong>you don’t need Scripting library at all if you
simply need to use Groovy classes as Fragments</strong></span>. Groovy is a fully Java compatible language and can be used directly,
similarly to Scala.</p><p>Then we’ll see how to use Groovy class scripts and method scripts.</p><p>All examples below are based on this type:</p><pre class="programlisting brush: java">package org.apache.polygene.library.scripting;
  [...snip...]


@Mixins(ScriptMixin.class)
public interface HelloSpeaker
{
    String sayHello();
}
</pre></div><div class="section" title="Using compiled Groovy classes"><div class="titlepage"><div><div><h4 class="title"><a id="_using_compiled_groovy_classes"></a>Using compiled Groovy classes</h4></div></div></div><p>To directly use compiled Groovy classes as Fragments you don’t need this library at all.</p><p>Having this Groovy class compiled ;</p><p title="HelloSpeakerMixin.groovy"><strong>HelloSpeakerMixin.groovy. </strong>
</p><pre class="programlisting brush: groovy">class HelloSpeakerMixin
    implements HelloSpeaker
{

    String sayHello() {
        "Hello there, Groovy"
    }
}
</pre><p title="HelloSpeakerMixin.groovy">
</p><p>assemble it directly:</p><pre class="programlisting brush: java">SingletonAssembler assembler = new SingletonAssembler(
    assembly -&gt; assembly.transients( HelloSpeaker.class )
                        .withMixins( HelloSpeakerMixin.class )
);
HelloSpeaker speaker = assembler.module().newTransient( HelloSpeaker.class );
assertThat( speaker.sayHello(), equalTo("Hello there, Groovy") );
</pre></div><div class="section" title="Using Groovy function scripts"><div class="titlepage"><div><div><h4 class="title"><a id="_using_groovy_function_scripts"></a>Using Groovy function scripts</h4></div></div></div><p>Declare a Groovy function in a resource file located in the same package as the implemented type with the name <code class="literal">&lt;type&gt;.groovy</code>:</p><p title="HelloSpeaker.groovy"><strong>HelloSpeaker.groovy. </strong>
</p><pre class="programlisting brush: groovy">def sayHello() {
    "Hello, Groovy"
}
</pre><p title="HelloSpeaker.groovy">
</p><p>Then assemble it with the normal <code class="literal">ScriptMixin</code>:</p><pre class="programlisting brush: java">SingletonAssembler assembler = new SingletonAssembler(
    assembly -&gt; assembly.values( HelloSpeaker.class )
                        .setMetaInfo( Scripting.GROOVY )
                        .withMixins( ScriptMixin.class )
);
HelloSpeaker speaker = assembler.module().newValue( HelloSpeaker.class );
assertThat( speaker.sayHello(), equalTo("Hello, Groovy") );
</pre></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="footer"><p>
        Copyright © 2015 The Apache Software Foundation, Licensed under the <a href="http://www.apache.org/licenses/" target="_blank">Apache License, Version 2.0</a>.
        <br /><small>
            Apache Polygene, Polygene, Apache, the Apache feather logo, and the Apache Polygene project logo are trademarks of The Apache Software Foundation.<br />
            All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </small></p></div></body></html>