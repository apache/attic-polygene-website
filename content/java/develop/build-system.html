<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Polygene™ Build System</title><link rel="stylesheet" type="text/css" href="css/style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="" /><link rel="up" href="tutorials.html" title="Tutorials" /><link rel="prev" href="howto-invocation-annotation.html" title="Use @Invocation" /><link rel="next" href="community-docs.html" title="Polygene™ Documentation" />


<!-- favicon -->

<link rel="shortcut icon" href="http://polygene.apache.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://polygene.apache.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/polygene.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>

<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Apache Polygene WebSite Progressive Enhancement -->

<link href="css/progressive-enhancement.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.scrollTo-1.4.2.js"></script>
<script type="text/javascript" src="js/progressive-enhancement.js"></script>

<!-- Analytics -->
 <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-62007352-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
 </script>

  </head><body><div xmlns="" xmlns:exsl="http://exslt.org/common" class="logo"><a href="index.html"><img src="images/logo-standard.png" style="width:80%;height:80%; padding-top:20px;" /></a></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="top-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl class="toc"><dt><span class="section"><a href="index.html#home">Polygene™</a></span></dt><dt><span class="section"><a href="intro.html">Introduction</a></span></dt><dt><span class="section"><span xmlns="" href="tutorials.html">Tutorials</span></span></dt><dt><span class="section"><a href="javadocs.html">Javadoc</a></span></dt><dt><span class="section"><a href="samples.html">Samples</a></span></dt><dt><span class="section"><a href="core.html">Core</a></span></dt><dt><span class="section"><a href="libraries.html">Libraries</a></span></dt><dt><span class="section"><a href="extensions.html">Extensions</a></span></dt><dt><span class="section"><a href="tools.html">Tools</a></span></dt><dt><span class="section"><a href="glossary.html">Glossary </a></span></dt></dl></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="sub-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl class="toc"><dt><span class="section"><a href="tutorials.html#_overview">Overview</a></span></dt><dt><span class="section"><a href="two-minutes-intro.html">Polygene™ in 2 minutes</a></span></dt><dt><span class="section"><a href="ten-minutes-intro.html">Polygene™ in 10 minutes</a></span></dt><dt><span class="section"><a href="thirty-minutes-intro.html">Polygene™ in 30 minutes</a></span></dt><dt><span class="section"><a href="howto-depend-on-polygene.html">Depend on Polygene™</a></span></dt><dt><span class="section"><a href="howto-assemble-application.html">Assemble an Application</a></span></dt><dt><span class="section"><a href="tut-composites.html">Transient Composites Tutorial</a></span></dt><dt><span class="section"><a href="tut-services.html">Services Composites Tutorial</a></span></dt><dt><span class="section"><a href="howto-contextual-fragments.html">Use contextual fragments</a></span></dt><dt><span class="section"><a href="howto-leverage-properties.html">Leverage Properties</a></span></dt><dt><span class="section"><a href="howto-create-constraint.html">Create a Constraint</a></span></dt><dt><span class="section"><a href="howto-create-concern.html">Create a Concern</a></span></dt><dt><span class="section"><a href="howto-create-sideeffect.html">Create a SideEffect</a></span></dt><dt><span class="section"><a href="howto-create-entity.html">Create an Entity</a></span></dt><dt><span class="section"><a href="howto-configure-service.html">Configure a Service</a></span></dt><dt><span class="section"><a href="howto-invocation-annotation.html">Use @Invocation</a></span></dt><dt><span class="section"><span xmlns="" href="build-system.html">Polygene™ Build System</span></span></dt><dt><span class="section"><a href="community-docs.html">Polygene™ Documentation</a></span></dt><dt><span class="section"><a href="releasing-apache.html">Releasing Polygene™</a></span></dt></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="build-system"></a>Polygene™ Build System</h3></div></div></div><p>This tutorial is intended for developers who want to build the Polygene™ SDK themselves.
It describe the Polygene™ SDK Build System from compilation to publication of artifacts for consumption by other
applications.</p><p>If instead you want to setup your project build system to depend on modules of the Polygene™ SDK see the
<a class="link" href="howto-depend-on-polygene.html" title="Depend on Polygene™">dedicated tutorial</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_gradle"></a>Gradle</h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>All major Java IDEs have great Gradle support.
Visit the <a class="ulink" href="https://www.gradle.org/resources" target="_top">Gradle</a> website to learn how to import the Polygene™ SDK build into your
favorite IDE.</p></div><p>Polygene™ community migrated away from Maven after several years of frustration, especially around release management,
versioning and cross-module dependency resolution issues, in Feb 2011.
The tool of choice is now Gradle, and it doesn’t require any installation, there are <code class="literal">gradlew</code> and <code class="literal">gradlew.bat</code> in
the root folder of the Polygene™ SDK that will bootstrap Gradle if not done so already.</p><p>If you are new to Gradle, you should keep the <a class="ulink" href="https://gradle.org/docs" target="_top">documentation</a> at hands.</p><p>Build System configuration is done through Gradle properties.
This can be done in many ways, see
<a class="ulink" href="https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_properties_and_system_properties" target="_top">Gradle properties and system properties</a>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_the_wrapper"></a>The Wrapper</h4></div></div></div><p><code class="literal">gradlew</code> and <code class="literal">gradlew.bat</code> scripts that can be found at the root of the Polygene sources is <span class="strong"><strong>The Wrapper</strong></span>.
Any build invocation starts from this script.
It will download the Gradle distribution version required by the build.
See the <a class="ulink" href="https://docs.gradle.org/current/userguide/gradle_wrapper.html" target="_top">Gradle Wrapper</a> documentation for more details.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_main_tasks"></a>Main tasks</h4></div></div></div><p>The Polygene™ SDK project has tasks that work with the whole SDK.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew downloadDependencies</code>
</span></dt><dd></dd></dl></div><p>Resolve, download and cache all needed dependencies.
Useful to go offline.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew</code>
</span></dt><dd></dd></dl></div><p>The default build, triggered when running gradle without any command line arguments, compiles the code and run the
tests, but nothing else. A quick way to check that nothing broke.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew clean</code>
</span></dt><dd></dd></dl></div><p>Clean up of all build output and restore the code base to a fresh state.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew assemble</code>
</span></dt><dd></dd></dl></div><p>Produces all the archives, javadocs, manuals and website content.
Global output is generated into <code class="literal">distributions/build</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew check</code>
</span></dt><dd></dd></dl></div><p>Run the tests and other checks like checkstyle.
Global reports are generated in <code class="literal">reports/build/reports</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew build</code>
</span></dt><dd></dd></dl></div><p>Equivalent to <code class="literal">./gradlew assemble check</code></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew checkDistributions</code>
</span></dt><dd></dd></dl></div><p>Run global checks against the assembled distributions.
Can take a while.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">./gradlew install</code>
</span></dt><dd></dd></dl></div><p>Is roughly the same as Maven’s install goal.
It produces the test reports, javadocs and installs all the Jars into the local disk repository, for consumption
by other applications.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_other_tasks"></a>Other tasks</h4></div></div></div><p>In addition to that, some submodules have specific tasks.
To see all available tasks, issue the following command:</p><pre class="programlisting brush: bash">./gradlew tasks</pre><p>All available tasks from all modules of the SDK are shown.
If you want to narrow your exploration to submodules use the following:</p><pre class="programlisting brush: bash">./gradlew :test:performance:tasks
./gradlew :release:tasks</pre><p>These examples will respectively output all gradle tasks available in the <code class="literal">:tests:performance</code> module where you should find
the <code class="literal">performanceTest</code> task that runs the Polygene™ performance test suite and the <code class="literal">:release</code> module tasks.</p><p><code class="literal">tasks</code> itself is a task, in the same way we can target module(s) with tasks, e.g.:</p><pre class="programlisting brush: bash">./gradlew :core:check :libraries:alarm:check</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_versions"></a>Versions</h4></div></div></div><p>By default, the build system produces a "zero build".
It means that there is no version assigned to the build, and a "0" is used in the produced artifacts.
This is due to our disagreement (with Maven community) that the "next" version name/number is known prior to
the release.
This is in our opinion a delayed decision.
To build a particular version, you specify a <code class="literal">version</code> property on the command-line, like</p><pre class="programlisting brush: bash">./gradlew -Dversion=2.0-FLAVOUR install</pre><p>If a <code class="literal">version</code> property is not defined, the build system will refuse to make a release and upload.
It will also try hard to do less and not get in your way.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_tests"></a>Tests</h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>See the <a class="ulink" href="https://builds.apache.org/view/P/view/Polygene/" target="_top">Polygene™ Continuous Integration</a> for current tests results</p></div><p>Unit and integration tests are located near the code under test.
You’ll find theses tests across the whole SDK.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_unit_tests_requiring_external_services"></a>Unit tests requiring external services</h5></div></div></div><p>Among unit tests, some require an external service to be run.
For example, the Redis EntityStore extension requires an actual Redis server to run its tests.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The HTML test reports generated by Gradle shows skipped tests.</p></div><p>Testing against external services is automated using Docker and is enabled automatically if a running Docker service
is reachable.
The build creates the necessary Docker images and start/stop containers around the tests.</p><p>On Linux it should work out of the box.</p><p>The simplest way to get this running on other systems (macOS and Windows) is to use <code class="literal">docker-machine</code> to create a
development Docker virtual machine where all images will be built and containers started:</p><pre class="programlisting brush: bash">docker-machine create dev
docker-machine start dev
eval $(docker-machine env dev)</pre><p>The last stanza set environment variables for Docker to use the newly created Docker virtual machine.</p><p>If you want to run the Docker containers in a remote machine, simply set the <code class="literal">DOCKER_HOST</code> and <code class="literal">DOCKER_CERT_PATH</code>
environment variables to something sensible for your setup.</p><p>If you want to forcibly skip all Docker related work, set the <code class="literal">skipDocker</code> Gradle property by e.g. appending
<code class="literal">-PskipDocker</code> to your Gradle command line.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_performance_tests"></a>Performance tests</h5></div></div></div><p>Performance tests provide performance measurements for typical Polygene™ use cases.
They are not part of the default build and are located in the <code class="literal">tests/performance</code> directory of the SDK.</p><p>They can be run with the following Gradle command:</p><pre class="programlisting brush: bash">./gradlew :tests:performance:performanceTest</pre><p>Results will then be available in the test reports.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_documentation_generation"></a>Documentation generation</h4></div></div></div><p>The build generates a documentation minisite:</p><pre class="programlisting brush: bash">./gradlew :manual:assemble</pre><p>Output is in <code class="literal">~/manual/build/docs/website</code>.</p><p>You’ll need Asciidoc and docbook-xsl installed.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_build_for_releases"></a>Build for releases</h4></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Remember that if a <code class="literal">version</code> property is not defined, the build system will refuse to make a release and upload.</p></div><p>The Polygene™ SDK build system is setup for an easy release process.
This is very useful to the Polygene™ Core Team but can also be useful to third parties that want to cut a in-house release.
In this regard, we try to make every aspect of the release process usable for such cases.</p><p>The following sections describe various aspects of the release process.
By default you need to have a proper PGP setup, see below.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_release_criteria"></a>Release Criteria</h5></div></div></div><p>The Polygene™ SDK modules are of varying maturity level and we try to maintain a STATUS (<code class="literal">dev-status.xml</code>) file indicating
how good the codebase, documentation and unit tests are for each of the modules. This is highly subjective and
potentially different individuals will judge this differently, but at least it gives a ballpark idea of the situation
for our users.</p><p>The Polygene™ SDK build system use the values from the <code class="literal">dev-status.xml</code> files to filter out non-releasable modules out for
the <code class="literal">javadocs</code> and <code class="literal">uploadArchives</code> root project tasks.
Moreover, the <code class="literal">release</code> task ensure that no releasable module depends on module(s) that don’t fit the release criteria
and throw a detailed exception if need be.</p><p>This can be relaxed by adding <code class="literal">-x checkReleaseSpec</code> arguments to gradle invocation.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_signing"></a>Signing</h5></div></div></div><p>Artifact signing is done using PGP.
You need to provide Gradle the following properties, <code class="literal">~/.gradle/gradle.properties</code> is a good place:</p><pre class="literallayout">signing.keyId=FB751943
signing.password=foobar
signing.secretKeyRingFile=/home/foo/.gnupg/secring.gpg</pre><p>You can skip the signing process by adding <code class="literal">-x signArchives</code> arguments to gradle invocation.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_artifact_upload"></a>Artifact Upload</h5></div></div></div><p>Artifact upload behavior depends on the version assigned to the build.</p><p>By default RELEASES are signed, SNAPSHOTS are not.
Signing can be turned on or off by setting the <code class="literal">uploadSigned</code> property to false.</p><p>By default RELEASES must satisfy ReleaseSpecification, SNAPSHOT don’t.
ReleaseSpecification usage can be turned on or off by setting the <code class="literal">uploadReleaseSpec</code> property to false.</p><p>By default RELEASES and SNAPHOTS are uploaded using HTTP.
Used Wagon can be overriden by setting the <code class="literal">uploadWagon</code> property.</p><p>By default RELEASES and SNAPSHOTS are uploaded to the Apache Nexus.
Target repository can be overriden by setting the <code class="literal">uploadRepository</code> property.</p><p>No username/password is provided by default.
If needed set them using the <code class="literal">uploadUsername</code> and <code class="literal">uploadPassword</code> properties.</p><p>For example here is how to deploy all artifacts as unsigned SNAPSHOTs to a given repository:</p><pre class="programlisting brush: bash">./gradlew uploadArchives -Dversion=3.2.1-SNAPSHOT -PuploadReleaseSpec=false \
    -PuploadWagon=what:ever:wagon -PuploadRepository=http://what.ever.repository/url \
    -PuploadUsername=foo -PuploadPassword=bar</pre><p>And here is how to deploy a signed release to the local filesystem:</p><pre class="programlisting brush: bash">./gradlew uploadArchives -Dversion=3.2.1 -PuploadRepository=file:///path/to/local/repository</pre><p>See the <a class="ulink" href="https://docs.gradle.org/current/userguide/maven_plugin.html#wagonLibs" target="_top">Gradle documentation</a> about
supported protocols.</p></div></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="footer"><p>
        Copyright © 2015 The Apache Software Foundation, Licensed under the <a href="http://www.apache.org/licenses/" target="_blank">Apache License, Version 2.0</a>.
        <br /><small>
            Apache Polygene, Polygene, Apache, the Apache feather logo, and the Apache Polygene project logo are trademarks of The Apache Software Foundation.<br />
            All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </small></p></div></body></html>